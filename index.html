<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Tetris</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: white;
    font-family: Arial;
  }
  canvas {
    background: black;
    border: 2px solid #555;
  }
</style>
</head>
<body>

<canvas id="game" width="200" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scale = 20;
ctx.scale(scale, scale);

const arena = Array.from({length: 20}, () => Array(10).fill(0));

const pieces = {
  T: [[0,1,0],[1,1,1]],
  O: [[1,1],[1,1]],
  L: [[0,0,1],[1,1,1]],
  J: [[1,0,0],[1,1,1]],
  I: [[1,1,1,1]],
  S: [[0,1,1],[1,1,0]],
  Z: [[1,1,0],[0,1,1]]
};

function collide(arena, player) {
  const [m, o] = [player.matrix, player.pos];
  for (let y=0;y<m.length;y++)
    for (let x=0;x<m[y].length;x++)
      if (m[y][x] && (arena[y+o.y]?.[x+o.x]) !== 0)
        return true;
  return false;
}

function merge(arena, player) {
  player.matrix.forEach((row,y)=>{
    row.forEach((v,x)=>{
      if(v) arena[y+player.pos.y][x+player.pos.x]=v;
    });
  });
}

function playerDrop() {
  player.pos.y++;
  if (collide(arena, player)) {
    player.pos.y--;
    merge(arena, player);
    playerReset();
  }
}

function playerReset() {
  const keys = Object.keys(pieces);
  player.matrix = pieces[keys[keys.length*Math.random()|0]];
  player.pos.y = 0;
  player.pos.x = (arena[0].length/2|0)-(player.matrix[0].length/2|0);
}

function drawMatrix(m, o) {
  m.forEach((row,y)=>{
    row.forEach((v,x)=>{
      if(v){
        ctx.fillStyle = "cyan";
        ctx.fillRect(x+o.x, y+o.y, 1, 1);
      }
    });
  });
}

function draw() {
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  drawMatrix(arena,{x:0,y:0});
  drawMatrix(player.matrix,player.pos);
}

let dropCounter=0, lastTime=0;
function update(time=0){
  const delta=time-lastTime;
  lastTime=time;
  dropCounter+=delta;
  if(dropCounter>800){
    playerDrop();
    dropCounter=0;
  }
  draw();
  requestAnimationFrame(update);
}

const player={pos:{x:0,y:0},matrix:null};
playerReset();
update();

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft") player.pos.x--;
  if(e.key==="ArrowRight") player.pos.x++;
  if(e.key==="ArrowDown") playerDrop();
});
</script>

</body>
</html>
